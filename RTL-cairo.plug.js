function u(r){let e=atob(r),n=e.length,o=new Uint8Array(n);for(let t=0;t<n;t++)o[t]=e.charCodeAt(t);return o}function c(r){typeof r=="string"&&(r=new TextEncoder().encode(r));let e="",n=r.byteLength;for(let o=0;o<n;o++)e+=String.fromCharCode(r[o]);return btoa(e)}var C=new Uint8Array(16);var y=class{constructor(e="",n=1e3){this.prefix=e;this.maxCaptureSize=n;this.prefix=e,this.originalConsole={log:console.log.bind(console),info:console.info.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),debug:console.debug.bind(console)},this.patchConsole()}originalConsole;logBuffer=[];patchConsole(){let e=n=>(...o)=>{let t=this.prefix?[this.prefix,...o]:o;this.originalConsole[n](...t),this.captureLog(n,o)};console.log=e("log"),console.info=e("info"),console.warn=e("warn"),console.error=e("error"),console.debug=e("debug")}captureLog(e,n){let o={level:e,timestamp:Date.now(),message:n.map(t=>{if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return String(t)}}).join(" ")};this.logBuffer.push(o),this.logBuffer.length>this.maxCaptureSize&&this.logBuffer.shift()}async postToServer(e,n){if(this.logBuffer.length>0){let t=[...this.logBuffer];this.logBuffer=[];try{if(!(await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.map(s=>({...s,source:n})))})).ok)throw new Error("Failed to post logs to server")}catch(i){console.warn("Could not post logs to server",i.message),this.logBuffer.unshift(...t)}}}},g;function f(r=""){return g=new y(r),g}var a=r=>{throw new Error("Not initialized yet")},d=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var p=new Map,l=0;d&&(globalThis.syscall=async(r,...e)=>await new Promise((n,o)=>{l++,p.set(l,{resolve:n,reject:o}),a({type:"sys",id:l,name:r,args:e})}));function h(r,e,n){d&&(a=n,self.addEventListener("message",o=>{(async()=>{let t=o.data;switch(t.type){case"inv":{let i=r[t.name];if(!i)throw new Error(`Function not loaded: ${t.name}`);try{let s=await Promise.resolve(i(...t.args||[]));a({type:"invr",id:t.id,result:s})}catch(s){console.error("An exception was thrown as a result of invoking function",t.name,"error:",s.message),a({type:"invr",id:t.id,error:s.message})}}break;case"sysr":{let i=t.id,s=p.get(i);if(!s)throw Error("Invalid request id");p.delete(i),t.error?s.reject(new Error(t.error)):s.resolve(t.result)}break}})().catch(console.error)}),a({type:"manifest",manifest:e}),f(`[${e.name} plug]`))}async function b(r,e){if(typeof r!="string"){let n=new Uint8Array(await r.arrayBuffer()),o=n.length>0?c(n):void 0;e={method:r.method,headers:Object.fromEntries(r.headers.entries()),base64Body:o},r=r.url}return syscall("sandboxFetch.fetch",r,e)}globalThis.nativeFetch=globalThis.fetch;function x(){globalThis.fetch=async function(r,e){let n=e&&e.body?c(new Uint8Array(await new Response(e.body).arrayBuffer())):void 0,o=await b(r,e&&{method:e.method,headers:e.headers,base64Body:n});return new Response(o.base64Body?u(o.base64Body):null,{status:o.status,headers:o.headers})}}d&&x();var m={},w={name:"RTL-cairo",main:"rtl-cairo.ts",assets:{},functions:{}},K={manifest:w,functionMapping:m};h(m,w,self.postMessage);export{K as plug};
